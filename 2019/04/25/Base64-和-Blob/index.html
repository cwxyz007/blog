<!DOCTYPE html><html><head><meta name="description" content="web 前端开发"/><meta name="author" content="Fantasy"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta http-equiv="XUA_Compatible" content="IE=edge"/><meta name="sw" content="true"/><meta name="ga" content="UA-101492756-1"/><meta name="ba" content="044e5dc9f3bc0a3b3042d15a4bbd8cae"/><link rel="icon" href="/favicon/favicon.ico"/><link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"/><link rel="stylesheet" href="https://unpkg.com/firement@0.0.5/dist/style.css"/><link rel="stylesheet" href="/css/layout.css"/><title>幻想❤乡 - Base64 和 Blob</title><meta name="generator" content="Hexo 5.0.0"></head><body><nav class="simple-layout-nav"><div class="simple-navbar"><div class="avatar-box"><a class="avatar-img" href="/"><img src="/imgs/avatar.jpg" alt="" srcset=""/></a><a class="info" href="/"><h3 class="author">Fantasy</h3><small class="subtitle">累了，就来这里歇歇</small></a></div><div class="menu"><span class="home"><a href="/"><i class="fa fa-home"></i>主页</a></span><span class="archives"><a href="/archives"><i class="fa fa-archive"></i>归档</a></span><span class="tags"><a href="/tags"><i class="fa fa-tag"></i>标签</a></span></div><div class="links"><span class="item"><a href="https://github.com//0x-jerry" target="_blank" rel="noopener"><i class="fa fa-github"></i><span>Github</span></a></span><span class="item"><a href="mailto:x.li.gem@gmail.com" target="_blank" rel="noopener"><i class="fa fa-envelope"></i><span>Email</span></a></span></div></div></nav><div class="simple-layout-content"><div class="simple-post"><h1 class="title">Base64 和 Blob</h1><p class="post-meta"><span class="meta date">2019-04-25</span><span class="meta license"><a alt="CC BY-NC 4.0" href="https://creativecommons.org/licenses/by-nc/4.0/deed.zh" target="_blank">CC BY-NC 4.0</a></span></p><div class="markdown-content" id="post-content"><h2 id="介绍">介绍</h2>
<p>利用 Base64 可以非常方便的存储/读取二进制文件，本文介绍如何在 Base64 和 Blob 之间转换</p>
<p>为什么要转换成 Blob 呢？ 因为 Blob 可以非常方便的转换成其他格式(文本，二进制，ArrayBuffer 等等)</p>
<blockquote>
<p>Base64 是一组相似的二进制到文本(binary-to-text)的编码规则，使得二进制数据在解释成 radix-64 的表现形式后能够用 ASCII 字符串的格式表示出来。Base64 这个词出自一种 MIME 数据传输编码。</p>
</blockquote>
<blockquote>
<p>Blob 对象表示一个不可变、原始数据的类文件对象。Blob 表示的不一定是 JavaScript 原生格式的数据。File 接口基于 Blob，继承了 blob 的功能并将其扩展使其支持用户系统上的文件。</p>
</blockquote>
<a id="more"></a>
<h2 id="Base64-To-Blob">Base64 To Blob</h2>
<ol>
<li>用 <code>atob</code> 解码一个 Base64 字符串 (<code>btoa</code> 可以把二进制数据编码成 Base64 格式)</li>
<li>把转换后的字符串写进 Unit8Array 数组里面</li>
<li>把 Unit8Array 数组转换成 Blob</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * https://stackoverflow.com/questions/16245767/creating-a-blob-from-a-base64-string-in-javascript</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param <span class="hljs-type">&#123;string&#125;</span> <span class="hljs-variable">dataURI</span></span></span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param <span class="hljs-type">&#123;number&#125;</span> <span class="hljs-variable">sliceSize</span></span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">dataURIToBlob</span>(<span class="hljs-params">dataURI, sliceSize = <span class="hljs-number">512</span></span>) </span>&#123;<br>  <span class="hljs-keyword">const</span> b64Data = dataURI.trim().split(<span class="hljs-string">&#x27;,&#x27;</span>)[<span class="hljs-number">1</span>]<br>  <span class="hljs-keyword">const</span> contentType = dataURI<br>    .split(<span class="hljs-string">&#x27;,&#x27;</span>)[<span class="hljs-number">0</span>]<br>    .split(<span class="hljs-string">&#x27;:&#x27;</span>)[<span class="hljs-number">1</span>]<br>    .split(<span class="hljs-string">&#x27;;&#x27;</span>)[<span class="hljs-number">0</span>]<br><br>  <span class="hljs-keyword">const</span> byteCharacters = atob(b64Data)<br>  <span class="hljs-keyword">const</span> byteArrays = []<br><br>  <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> offset = <span class="hljs-number">0</span>; offset &lt; byteCharacters.length; offset += sliceSize) &#123;<br>    <span class="hljs-keyword">const</span> slice = byteCharacters.slice(offset, offset + sliceSize)<br><br>    <span class="hljs-keyword">const</span> byteNumbers = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Array</span>(slice.length)<br>    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">let</span> i = <span class="hljs-number">0</span>; i &lt; slice.length; i++) &#123;<br>      byteNumbers[i] = slice.charCodeAt(i)<br>    &#125;<br><br>    <span class="hljs-keyword">const</span> byteArray = <span class="hljs-keyword">new</span> <span class="hljs-built_in">Uint8Array</span>(byteNumbers)<br>    byteArrays.push(byteArray)<br>  &#125;<br><br>  <span class="hljs-keyword">const</span> blob = <span class="hljs-keyword">new</span> Blob(byteArrays, &#123; <span class="hljs-attr">type</span>: contentType &#125;)<br>  <span class="hljs-keyword">return</span> blob<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="Blob-To-Base64">Blob To Base64</h2>
<ol>
<li>直接利用 FileReader 把 Blob 转换成 Base64</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param <span class="hljs-type">&#123;Blob&#125;</span> <span class="hljs-variable">blob</span></span></span><br><span class="hljs-comment"> */</span><br><span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readBlob</span>(<span class="hljs-params">blob</span>) </span>&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve</span>) =&gt;</span> &#123;<br>    <span class="hljs-keyword">const</span> reader = <span class="hljs-keyword">new</span> FileReader()<br>    reader.onload = <span class="hljs-function">(<span class="hljs-params">evt</span>) =&gt;</span> resolve(evt.target.result)<br><br>    reader.readAsDataURL(blob)<br>  &#125;)<br>&#125;<br></code></pre></td></tr></table></figure>
<h2 id="参考">参考</h2>
<ul>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/Blob">https://developer.mozilla.org/zh-CN/docs/Web/API/Blob</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Mozilla/Add-ons/SDK/High-Level_APIs/base64">https://developer.mozilla.org/zh-CN/docs/Mozilla/Add-ons/SDK/High-Level_APIs/base64</a></li>
<li><a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/API/WindowBase64/Base64_encoding_and_decoding">https://developer.mozilla.org/zh-CN/docs/Web/API/WindowBase64/Base64_encoding_and_decoding</a></li>
</ul>
</div><hr class="post-end"/><div class="post-footer"><div class="post-license">版权声明：本文使用 <a alt="CC BY-NC 4.0" href="https://creativecommons.org/licenses/by-nc/4.0/deed.zh" target="_blank">CC BY-NC 4.0</a> 协议</div><div class="partial-simple-tags"><ul><li><a href="/tags/JavaScript/"><i class="fa fa-tag"></i>JavaScript</a></li></ul></div></div><div id="post-comment"></div></div></div><div id="post-nav"></div><div class="simple-footer"><p> Powered by
  <a class="footer-link" href="https://github.com//0x-jerry/hexo-simple-template" target="_blank" rel="noopener">Simple</a>
  and
  <a class="footer-link" href="https://hexo.io" target="_blank" rel="noopener">Hexo</a>
  , Made By
  <a class="footer-link" href="https://github.com//0x-jerry" target="_blank" rel="noopener">@Fantasy</a>
</p>
</div><script src="/js/index.js"></script></body></html>