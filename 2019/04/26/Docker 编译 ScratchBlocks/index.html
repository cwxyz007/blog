<!DOCTYPE html><html><head><meta name="description" content="web 前端开发"/><meta name="author" content="Fantasy"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta http-equiv="XUA_Compatible" content="IE=edge"/><meta name="sw" content="true"/><meta name="ga" content="UA-101492756-1"/><meta name="ba" content="044e5dc9f3bc0a3b3042d15a4bbd8cae"/><link rel="icon" href="/favicon/favicon.ico"/><link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"/><link rel="stylesheet" href="https://unpkg.com/firement@0.0.5/dist/style.css"/><link rel="stylesheet" href="/css/layout.css"/><title>幻想❤乡 - Docker 编译 ScratchBlocks</title><meta name="generator" content="Hexo 5.0.0"></head><body><nav class="simple-layout-nav"><div class="simple-navbar"><div class="avatar-box"><a class="avatar-img" href="/"><img src="/imgs/avatar.jpg" alt="" srcset=""/></a><a class="info" href="/"><h3 class="author">Fantasy</h3><small class="subtitle">累了，就来这里歇歇</small></a></div><div class="menu"><span class="home"><a href="/"><i class="fa fa-home"></i>主页</a></span><span class="archives"><a href="/archives"><i class="fa fa-archive"></i>归档</a></span><span class="tags"><a href="/tags"><i class="fa fa-tag"></i>标签</a></span></div><div class="links"><span class="item"><a href="https://github.com//0x-jerry" target="_blank" rel="noopener"><i class="fa fa-github"></i><span>Github</span></a></span><span class="item"><a href="mailto:x.li.gem@gmail.com" target="_blank" rel="noopener"><i class="fa fa-envelope"></i><span>Email</span></a></span></div></div></nav><div class="simple-layout-content"><div class="simple-post"><h1 class="title">Docker 编译 ScratchBlocks</h1><p class="post-meta"><span class="meta date">2019-04-26</span><span class="meta license"><a alt="CC BY-NC 4.0" href="https://creativecommons.org/licenses/by-nc/4.0/deed.zh" target="_blank">CC BY-NC 4.0</a></span></p><div class="markdown-content" id="post-content"><h2 id="简介">简介</h2>
<p>很久之前就研究过 Docker，苦于一直没有找到应用场景（毕竟经常写的是前端）</p>
<p>最近在研究 <code>Scratch-Blocks</code> ，每次打包都需要在虚拟机里面打包（因为需要 Python 和 Java 环境），还比较慢。<br>
今天就尝试了一下是不是可以用 Docker 来打包，这样就可以直接挂服务器上一键打包了。结果是肯定的，当然没问题</p>
<h2 id="Dockerfile">Dockerfile</h2>
<p>既然是 Docker， 那第一步肯定是写 Dockerfile 和 Dockerignore 了，Dockerignore 根据项目写就完了，语法和 gitignore 一样</p>
<a id="more"></a>
<p>需要注意的是，要缓存 node_modules，所以在执行 build 命令之前需要先单独复制 yarn.lock 文件，然后执行 <code>yarn install --ignore-scripts</code> 达到缓存 node_modules 的目的</p>
<p>这是因为 <code>RUN, COPY, ADD</code> 指令每次都会创建中间容器（缓存用），这样每次 yarn.lock 改变才会执行 <code>yarn install</code> 命令，这样也就达到了缓存 node_modules 的目的</p>
<p>有时候可能还需要 <code>package.json</code> 文件，这里也加上</p>
<figure class="highlight dockerfile"><figcaption><span>Dockerfile</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs Dockerfile"><span class="hljs-comment"># linux core, only 5M</span><br><span class="hljs-keyword">FROM</span> alpine<br><br><span class="hljs-keyword">WORKDIR</span><span class="bash"> /app</span><br><br><span class="hljs-comment"># install nodejs python java</span><br><span class="hljs-keyword">RUN</span><span class="bash"> apk update &amp;&amp; apk add python nodejs yarn openjdk8</span><br><br><span class="hljs-comment"># cache node_modules accord by yarn.lock</span><br><span class="hljs-keyword">COPY</span><span class="bash"> yarn.lock /app</span><br><span class="hljs-keyword">COPY</span><span class="bash"> package.json /app</span><br><span class="hljs-keyword">RUN</span><span class="bash"> yarn install --ignore-scripts</span><br><br><span class="hljs-keyword">COPY</span><span class="bash"> . /app</span><br><br><span class="hljs-comment"># build</span><br><span class="hljs-keyword">RUN</span><span class="bash"> yarn build</span><br></code></pre></td></tr></table></figure>
<p>然后打包 <code>docker build --rm -f &quot;Dockerfile&quot; -t scratch-blocks:latest .</code>，收工完成</p>
<p>文中提到的命令以及参数请参考 <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/build/">docker build 文档</a>、<a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/">Dockerfile 文档</a></p>
</div><hr class="post-end"/><div class="post-footer"><div class="post-license">版权声明：本文使用 <a alt="CC BY-NC 4.0" href="https://creativecommons.org/licenses/by-nc/4.0/deed.zh" target="_blank">CC BY-NC 4.0</a> 协议</div><div class="partial-simple-tags"><ul><li><a href="/tags/Docker/"><i class="fa fa-tag"></i>Docker</a></li><li><a href="/tags/Linux/"><i class="fa fa-tag"></i>Linux</a></li></ul></div></div><div id="post-comment"></div></div></div><div id="post-nav"></div><div class="simple-footer"><p> Powered by
  <a class="footer-link" href="https://github.com//0x-jerry/hexo-simple-template" target="_blank" rel="noopener">Simple</a>
  and
  <a class="footer-link" href="https://hexo.io" target="_blank" rel="noopener">Hexo</a>
  , Made By
  <a class="footer-link" href="https://github.com//0x-jerry" target="_blank" rel="noopener">@Fantasy</a>
</p>
</div><script src="/js/index.js"></script></body></html>